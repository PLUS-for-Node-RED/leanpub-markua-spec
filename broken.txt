<div class="extension">

## Figure Titles

A resource which is inserted as a figure can have a figure title.

This title shows up in two places in the output:

1. Near the resource, typically above or below it, per the preference of the
Markua Processor.
2. Based on the resource type, either in the List of Illustrations, List of
Tables or Table of Figures, if they are generated for the book. This text
should also be a crosslink to the title inserted near the figure itself.

The title for a figure can provided in one of two ways:

1. In quotes after the filename or URL of a local or web resource.
   ~~~
   ![](algorithm.rb "My Amazing Algorithm")
   ~~~
2. In the attribute list above the resource.
   ~~~
   {title: "My Amazing Algorithm"}
   ![](algorithm.rb)
   ~~~

The first choice is clearly shorter, as well as more pleasant to write and to
read.

Since inline resources do not use the bracket syntax, any titles must be added
in the attribute list:

~~~
{title: "My Amazing Algorithm"}
```ruby
puts "hello world"
```
~~~

##### Figure alt text

A figure can have alt text, as long as the type of resource being inserted
supports alt text. The resource location does not matter: local, web and inline
resources all support alt text.

Alt text is text which is intended to take the place of the resource if the
resource itself cannot be seen. In the case of images, the obvious use case is
for readers with visual disabilities who are using a screen reader, but it also
includes audiobooks and ebook readers which often do not support embedded
images, audio and video, and which may have a hard time displaying math.

Here's an example of good alt text:

~~~
![a red apple, possibly a McIntosh or Spartan](fruit.jpg)
~~~

You can also use an attribute list:

~~~
{alt: "a red apple, possibly a McIntosh or Spartan"}
![](fruit.jpg)
~~~

The alt text should **not** have the same content as the figure title, if the
figure title is present. (Imagine the annoyance for someone with a visual
disability having their screen reader read identical alt text and figure titles
to them throughout an entire book!)

Instead, the alt text should be descriptive of the image content, while the figure
title can be more creative. For example, a figure title may be "Washington
Crossing the Delaware" and the alt text could be "Denzel Washington on a boat in
a river." Having good alt text would enable readers who cannot see the image to
still get the joke which the figure title makes.

##### Figure titles and alt text together

These are some examples of figures with both alt text and a figure title:

~~~
![a red apple](mac.jpg "The Original Mac")

{alt: "a red apple", title: "The Original Mac"}
![](mac.jpg)

{alt: "a blue circle", title: "Earth From Space (Simplified)"}
```!
<svg width="20" height="20">
  <circle cx="10" cy="10" r="9" fill="blue"/>
</svg>
```
~~~

##### The figure attribute list takes precedence

It is always an error to specify an attribute both in the attribute list for a
figure and in the syntactic sugar locations, either after the backticks or in the
square brackets.

However, if this is done, then the value in the attribute list takes precedence.

In the following figure, the format is `text` not `ruby`:

~~~
{format: text}
```ruby
puts "hello world"
```
~~~

In the following figure, the alt text would be "foo" not "bar":

~~~
{alt: foo}
![bar](foo.png)
~~~

In the following figure, the title text would be "foo" not "bar":

~~~
{title: foo}
![](foo.png "bar")
~~~

Again, the Markua Processor should treat all of these as an error.

#### Spans

Inserting a resource as a span means to continue the block context which it is
in, instead of starting a new leaf block for the resource.

There are three types of resources which can be inserted as spans:

1. Single-line inline code resources.
2. A `math` resource (regardless of location) without a title.
3. A local or web `image` resource without a title.

An inline code resource can be inserted as a span using the following syntax:

~~~
backtick `resource`format backtick
~~~

The math formats, including the syntactic sugar for them, are discussed later.

A local image resource without a title can be inserted as expected:

~~~
This is an ![a red apple](mac.jpg) not a banana.
~~~

A web image resource without a title can be inserted as expected:

~~~
This is an ![a red apple](http://markua.com/mac.jpg) not a banana.
~~~

Note that inline image resources cannot be inserted as spans, since even SVG is
so verbose it would make the resulting document very hard to read.

Also, note that if you wish to insert an image in the middle of a sentence,
chances are you are trying to insert an emoji. You can do this with a span image,
if you want exact control of what your emoji look like. However, note that emoji
also have special support in Markua, described [here](#emoji).

Finally, if a title is present, the Markua Processor must treat the resource
as having implicit newlines before and after it, so that it is handled as a
figure. (Figure titles do not make sense inside of sentences.)

~~~
This is ![a red apple](mac.jpg "The Original Mac") not a banana.
~~~

##### Span attribute lists can be used to set the format

When a resource is inserted as a span, the resource is inserted as part of the
flow of text of a paragraph with no newlines before or after it. A span resource
is intended to be extremely short and simple.

By default, the type of an inline resource is `code` and the format is `guess`.
Math and SVG images override this using special syntaxes, discussed later.

However, to support rare use cases, any span can have an attribute list. The
attribute list on a span is specified immediately after the closing backtick.
Span attribute lists can be used to set the format explicitly.

For example, this resource would be formatted as Ruby code:
~~~
Yada yada `puts "hi"`{format: ruby} yada yada.
~~~



## Resource locations (M)

The **Location** is the location of the resource, when encountered by the
Markua Processor. There is no attribute for this; it is inferred from the
location.
* An inline resource is included directly in a Markua manuscript file.
* A local resource is located in the `resources` directory which accompanies
the Markua manuscript (or in a similar conceptual location for a web-based
Markua Processor).
* A web resource is on the web, accessed via `http://` or `https://`.

A resource is either considered a local, web or inline resource based on its
location:

Local Resource
: The resource is stored along with the manuscript--either in a `resources`
directory on a local filesystem, or uploaded to the same web service where the
Markua document is being written.

Web Resource
: The resource is referred to via an `http` or `https` URL.

Inline Resource
: The resource is defined right in the body of a Markua document.

### Local resources

If local resources are used, all local resources must be stored inside a
`resources` directory, or one of its subdirectories. The `resources` directory
is not part of the path to the resource.

Here's how the paths to local resources work:

1. An image called `foo.jpg` in the `resources` directory should be referred to
   as `![](foo.jpg)`, but can also be referred to as `![](resources/foo.jpg)`.
2. An image called `bar.png` in a subdirectory `images` of the `resources`
   directory should be referred to as `![](images/bar.png)`, but can also be
   referred to as `![](resources/images/foo.jpg)`.
3. For security reasons, leading slashes `/` and navigating upward (`../`) are
   not allowed: `![](/foo.jpg)`, `![](/images/bar.png)` and `![](../foo.jpg)`
   are all illegal.

The reason that paths can either include or omit the resources directory is
simple: including it makes it a simple relative path, which means that
Markdown-aware tools that support, say, external images will just work. However,
omitting it is nice to type, so this is something which should be supported as
well. And the reason the resources directory exists is to keep the Markua
manuscript file(s) separate from the resources, to reduce clutter.

Nested directory trees work as well. A file called `foo.rb` in a
`ch1/examples/ruby` directory tree inside the `resources` directory is referenced
as `![](ch1/examples/ruby/foo.rb)` or as `![](resources/ch1/examples/ruby/foo.rb)`.

Markua does not specify whether there are any subdirectories of the `resources`
directory, or what their names are. Since any subdirectories have their names as
part of the path to the resource, authors can do whatever they want. For example,
you can create subdirectories of the `resources` directory for different types of
resource, such as `audio`, `code`, `images`, etc., but you can also just put them
all in the `resources` directory together. To be clear: the names of the
directories have no meaning, and do not restrict the formats of what can go inside
them.

If you are using a hosted service to write in Markua, this service can store
resources wherever it wants. However, if they provide a download (say as a zip
file) they should create the resources directory and provide the uploaded
resources in that directory. If a nested structure is used, it should be exported
that way--if a web service produces paths which reference images inside an images
directory (e.g. as `images/foo.png`), then the zip file containing an export
should contain a `resources` directory which contains an `images` subdirectory
with the images.

### Web resources

If web resources are supported, both `http:` and `https:` resources should be
supported.

Web resources are identified by the absolute URL of the resource on the internet.

### Inline resources

Certain types of resources can be inserted inline in a Markua document:

* `code`
* `image` (of SVG format only)
* `list`
* `math` (either `latexmath` or `asciimath`)
* `table`
* `verbatim`

Since an SVG image is just XML text, it can be contained inline in the text of a
Markua document. This is not true for binary resources like PNG or JPEG images
or any type of audio or video file--these can only be local or web resources.

The syntax for SVG images is discussed later.

</div>


